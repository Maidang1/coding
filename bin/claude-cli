#!/usr/bin/env bun

import { readFileSync } from "fs";
import { join } from "path";
import { fileURLToPath } from "url";
import { dirname } from "path";
import { render } from "ink";
import React from "react";
import { App } from "../src/ui/App.js";

const __filename = fileURLToPath(import.meta.url);
const __dirname = dirname(__filename);

function getVersion(): string {
  const packageJsonPath = join(__dirname, "../package.json");
  const packageJson = JSON.parse(readFileSync(packageJsonPath, "utf-8"));
  return packageJson.version;
}

function displayHelp(): void {
  console.log(`claude-cli - TUI coding agent powered by Claude AI

Usage:
  claude-cli [options]

Options:
  --help     Display this help message
  --version  Display version information

Environment Variables:
  ANTHROPIC_API_KEY  Required. Your Anthropic API key

Example:
  ANTHROPIC_API_KEY=sk-... claude-cli
`);
}

function displayVersion(): void {
  console.log(`claude-cli ${getVersion()}`);
}

function main(): void {
  const args = process.argv.slice(2);

  if (args.length === 0) {
    const apiKey = process.env.ANTHROPIC_API_KEY;
    if (!apiKey) {
      console.error(
        "Error: ANTHROPIC_API_KEY environment variable is required"
      );
      process.exit(1);
    }

    render(React.createElement(App, { apiKey }));
    return;
  }

  const firstArg = args[0];

  if (firstArg === "--help" || firstArg === "-h") {
    displayHelp();
    return;
  }

  if (firstArg === "--version" || firstArg === "-v") {
    displayVersion();
    return;
  }

  if (firstArg.startsWith("--")) {
    displayHelp();
    return;
  }

  displayHelp();
}

main();
